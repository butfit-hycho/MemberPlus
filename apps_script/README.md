# 📊 유효회원/휴면회원 추출 시스템 (Google Apps Script 버전)

## 📋 개요
서버 없이 Google Apps Script를 사용하여 레플리카 데이터베이스에서 유효회원과 휴면회원을 추출하여 구글 스프레드시트에 업로드하는 시스템입니다.

## ✨ 주요 장점
- 🚀 **서버 없음**: 별도 서버 설치 불필요
- 🔐 **보안**: 구글 계정 기반 인증
- 📱 **간편함**: 스프레드시트 내에서 직접 실행
- 💰 **무료**: 구글 계정만 있으면 사용 가능
- 🔄 **실시간**: 즉시 데이터 추출 및 업로드

## 🛠️ 설치 방법

### 1단계: 구글 스프레드시트 열기
1. [https://docs.google.com/spreadsheets/d/1Zi2VmX1Mp2swgC5QlwvAjhndc-MH8SM4YR1TlqNMjm4](https://docs.google.com/spreadsheets/d/1Zi2VmX1Mp2swgC5QlwvAjhndc-MH8SM4YR1TlqNMjm4) 접속
2. 스프레드시트를 복사하여 본인 계정으로 이동 (파일 > 사본 만들기)

### 2단계: Apps Script 에디터 열기
1. 스프레드시트에서 **확장 프로그램 > Apps Script** 클릭
2. 새 Apps Script 프로젝트가 열림

### 3단계: 코드 복사
1. 기본 `Code.gs` 파일 내용을 모두 삭제
2. `apps_script/Code.gs` 파일 내용을 복사하여 붙여넣기
3. **파일 > 새로 만들기 > HTML 파일** 클릭
4. 파일명을 `index`로 설정
5. `apps_script/index.html` 파일 내용을 복사하여 붙여넣기

### 4단계: 프로젝트 설정
1. Apps Script 에디터에서 **프로젝트 설정** (⚙️) 클릭
2. **매니페스트 파일 표시** 체크박스 활성화
3. `appsscript.json` 파일이 나타나면 내용을 삭제하고 `apps_script/appsscript.json` 내용 복사

### 5단계: 권한 설정
1. **편집기**로 돌아가서 **배포 > 새 배포** 클릭
2. **유형** 선택에서 **웹 앱** 선택
3. **액세스 권한**을 **나만** 또는 **조직 내 모든 사용자**로 설정
4. **배포** 클릭

### 6단계: 서비스 활성화
1. **서비스** 탭에서 **Google Sheets API** 추가
2. Apps Script 에디터에서 **리소스 > 고급 Google 서비스** 클릭
3. **Google Sheets API v4** 활성화

### 7단계: 데이터베이스 연결 설정
1. **Google Cloud Console**에서 프로젝트 선택
2. **API 및 서비스 > 라이브러리**에서 **Google Cloud SQL API** 활성화
3. **IAM 및 관리 > 서비스 계정**에서 서비스 계정 생성
4. 서비스 계정에 **Cloud SQL 클라이언트** 역할 부여

## 🚀 사용 방법

### 1. 스프레드시트에서 실행
1. 스프레드시트 상단 메뉴에서 **유효회원/휴면회원 추출 > 데이터 추출 시작** 클릭
2. 팝업 창에서 지점 선택
3. **데이터 추출 시작** 버튼 클릭
4. 진행률 확인 후 완료 대기
5. **스프레드시트 열기** 버튼으로 결과 확인

### 2. 주요 기능
- 📍 **지점 선택**: 드롭다운에서 원하는 지점 선택
- 🔄 **실시간 진행률**: 데이터 추출 진행 상황 확인
- 📊 **자동 시트 생성**: 지점별 유효회원, 휴면회원, 요약 시트 생성
- 🧪 **연결 테스트**: 데이터베이스 연결 상태 확인
- 🔄 **지점 목록 새로고침**: 최신 지점 목록 업데이트

### 3. 생성되는 시트
각 지점별로 3개의 시트가 생성됩니다:
- `{지점명}_유효회원`: 유효한 멤버십을 가진 회원 목록
- `{지점명}_휴면회원`: 멤버십이 만료된 회원 목록
- `{지점명}_요약`: 유효회원/휴면회원 수량 요약

## ⚠️ 주의사항

### 실행 시간 제한
- Google Apps Script는 **6분** 실행 시간 제한이 있습니다
- 대용량 데이터 처리 시 시간 초과 가능
- 전체 지점 조회 시 시간 초과 위험

### 메모리 제한
- 대용량 데이터 처리 시 메모리 제한 도달 가능
- 지점별로 나누어 처리하는 것을 권장

### 데이터베이스 연결
- 외부 데이터베이스 연결 시 방화벽 설정 필요
- VPN이나 화이트리스트 설정 필요할 수 있음

### 보안
- 데이터베이스 비밀번호가 코드에 노출됨
- 프로젝트 공유 시 주의 필요
- 개인정보 처리 시 보안 규정 준수

## 🔧 트러블슈팅

### 1. 데이터베이스 연결 실패
```
오류: 데이터베이스 연결에 실패했습니다
해결: 
1. 네트워크 연결 확인
2. VPN 연결 확인
3. DB 서버 상태 확인
4. 방화벽 설정 확인
```

### 2. 권한 오류
```
오류: 권한이 없습니다
해결:
1. 스프레드시트 편집 권한 확인
2. Apps Script 실행 권한 확인
3. 구글 계정 로그인 상태 확인
```

### 3. 시간 초과 오류
```
오류: 실행 시간 초과
해결:
1. 지점별로 개별 실행
2. 데이터 범위 축소
3. 여러 번에 나누어 실행
```

### 4. 메모리 부족
```
오류: 메모리 부족
해결:
1. 불필요한 데이터 필터링
2. 배치 처리 구현
3. 결과 데이터 압축
```

## 🔄 업데이트 방법

### 코드 업데이트
1. Apps Script 에디터에서 코드 수정
2. **저장** (Ctrl+S) 후 **배포 > 배포 관리** 클릭
3. **새 버전** 선택 후 **배포** 클릭

### 데이터베이스 정보 변경
1. `Code.gs` 파일의 `DB_CONFIG` 객체 수정
2. 호스트, 포트, 사용자명, 비밀번호 업데이트

### 스프레드시트 변경
1. `SPREADSHEET_ID` 변수 수정
2. 새 스프레드시트 ID로 변경

## 🆚 Python 버전과 비교

| 기능 | Python/Streamlit | Google Apps Script |
|------|------------------|-------------------|
| 서버 | 필요 | 불필요 |
| 설치 | 복잡 | 간단 |
| 보안 | 직접 관리 | 구글 관리 |
| 성능 | 높음 | 제한적 |
| 커스터마이징 | 높음 | 제한적 |
| 비용 | 서버 비용 | 무료 |
| 실행 시간 | 무제한 | 6분 제한 |

## 📞 지원

문제가 발생하거나 도움이 필요한 경우:
1. 실행 로그 확인 (Apps Script 에디터 > 실행 내역)
2. 콘솔 로그 확인 (브라우저 개발자 도구)
3. 오류 메시지 캡처 후 문의

## 🎯 개선 사항

향후 추가 예정 기능:
- 📊 대시보드 차트 추가
- 📧 이메일 알림 기능
- 📅 스케줄링 실행
- 📈 데이터 분석 기능
- 🔄 자동 새로고침

---

**💡 팁**: 처음 사용 시 "연결 테스트" 버튼으로 데이터베이스 연결을 확인한 후 사용하세요! 